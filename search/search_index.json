{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to infomatico's","text":"<p>O guri da TI, ou da forma mais raiz, sysadmin, o guardi\u00e3o dos servidores e mestre dos c\u00f3digos, enfrenta diariamente os desafios do reino digital. Com suas habilidades afiadas como uma espada, ele mant\u00e9m a estabilidade do sistema, defendendo-o contra as amea\u00e7as cibern\u00e9ticas como um cavaleiro destemido. No campo de batalha DevSecOps, ele se une aos desenvolvedores, forjando alian\u00e7as para criar fortalezas de c\u00f3digo seguro. O DevOps, com sua harmonia entre desenvolvimento e opera\u00e7\u00f5es, \u00e9 a chave que transforma o caos em sinfonia digital. Juntos, esses her\u00f3is modernos trilham o caminho da inova\u00e7\u00e3o, construindo pontes entre mundos para garantir a prosperidade do reino tecnol\u00f3gico.</p>"},{"location":"backup-and-restore/","title":"Backup & restore","text":""},{"location":"backup-and-restore/#backup-com-o-bacula","title":"Backup com o Bacula","text":"<p>Pode-se configurar o bacula para backup dos dados e db do AD.</p>"},{"location":"backup-and-restore/#restaurando-o-arquivo-de-backup","title":"Restaurando o arquivo de backup","text":"<p>O passo para restaurar um backup \u00e9 semelhante \u00e0 'provis\u00e3o de dom\u00ednio' que voc\u00ea fez quando configurou pela primeira vez sua rede Samba, exceto que desta vez o backup cont\u00e9m todos os objetos de banco de dados que voc\u00ea adicionou desde ent\u00e3o. Semelhante \u00e0 realiza\u00e7\u00e3o de uma provis\u00e3o, voc\u00ea precisa especificar um novo Controlador de Dom\u00ednio (DC) ao executar o comando de restaura\u00e7\u00e3o.</p>"},{"location":"backup-and-restore/#preparacao-do-ambiente","title":"Prepara\u00e7\u00e3o do ambiente","text":"<p>Como ser\u00e1 necess\u00e1rio outro nome de hostname, antes da execu\u00e7\u00e3o do comando, troque o nome do hostname no arquivo <code>/etc/hostname</code> e tamb\u00e9m no <code>/etc/hosts</code>.</p> <p>Para que os dados fiquem no diretorio default de instala\u00e7\u00e3o, ter\u00e1 que mover a pasta <code>/var/lib/samba</code> para outro local.</p> <pre><code>mv /var/lib/samba /root\n</code></pre>"},{"location":"backup-and-restore/#executando-o-comando","title":"Executando o comando","text":"<p>Ap\u00f3s mover, conseguir\u00e1 executar o comando abaixo. Observe que o diret\u00f3rio de destino especificado deve estar vazio (ou n\u00e3o existir).</p> <pre><code>samba-tool domain backup restore --backup-file=samba-backup-2023-12-31T10-06-04.581319.tar.bz2 --newservername=dc002 --targetdir=/var/lib/samba --site=\"Default-First-Site-Name\" --host-ip=10.10.10.7\n</code></pre>"},{"location":"backup-and-restore/#movendo-e-modificando-arquivos-e-pastas","title":"Movendo e modificando arquivos e pastas","text":"<p>Depois do processo de restore, mova a seguinte pasta:</p> <ol> <li>Dentro da pasta <code>/var/lib/samba/state</code> ter\u00e1 a pasta <code>sysvol</code> que deveer\u00e1 ser movida para <code>/var/lib/samba</code></li> <li>No arquivo <code>/etc/samba/smb.conf</code> substitua o antigo <code>netbios name</code> para o novo nome, no caso do comando acima, <code>dc002</code></li> </ol>"},{"location":"backup-and-restore/#fazendo-o-demote-do-antigo-dc","title":"Fazendo o demote do antigo DC","text":"<pre><code>samba-tool domain demote --remove-other-dead-server=DCXXX\n</code></pre>"},{"location":"backup-and-restore/#colocando-no-dominio","title":"Colocando no dominio","text":"<p>Ap\u00f3s todos os passos acima, ter\u00e1 que re-colocar no dominio. Para isso execute o comando abaixo.</p> <pre><code>samba-tool domain join campus.site.intra DC -U\"CAMPUS\\administrator\" --option='idmap_ldb:use rfc2307 = yes' --dns-backend=BIND9_DLZ\n</code></pre> <p>Ser\u00e1 solicitado a senha de <code>administrator</code>.</p>"},{"location":"backup-and-restore/#reconfigurando-o-dns","title":"Reconfigurando o DNS","text":"<p>Para reconfigurar o DNS execute o comando abaixo:</p> <pre><code>samba_upgradedns --dns-backend=BIND9_DLZ\n</code></pre> <p>Verifique se est\u00e1 tudo ok com o DNS.</p> <pre><code>samba_dnsupdate --verbose --all-names\n</code></pre>"},{"location":"backup-and-restore/#reboot","title":"Reboot","text":"<p>Por fim, d\u00ea um reboot na maquina.</p> <p>Teste os servi\u00e7os do samba e do DNS com os comandos:</p> <pre><code>systemctl status samba-ad-dc.service \nsystemctl status named.service\n</code></pre> <p>Verifique a replica\u00e7\u00e3o</p> <pre><code>samba-tool drs showrepl\n</code></pre> <p>Verifique os logs</p> <pre><code>tail -f /var/log/samba/log.samba\n</code></pre>"},{"location":"install-provision-samba4/","title":"Install & provision ADDC 4.19.x","text":"<p>Lista oficial do Samba</p>"},{"location":"install-provision-samba4/#instalacao-e-atualizacao-da-distro-base","title":"Instala\u00e7\u00e3o e Atualiza\u00e7\u00e3o da Distro base","text":"<p>Distro: Debian 12</p>"},{"location":"install-provision-samba4/#atualizando","title":"Atualizando","text":"<pre><code>apt update &amp;&amp; apt full-upgrade\n</code></pre>"},{"location":"install-provision-samba4/#modificar-o-arquivo-etchosts","title":"Modificar o arquivo /etc/hosts","text":"<pre><code>127.0.0.1        localhost\n172.16.1.7       DC1.samdom.dominio.intra   DC1\n</code></pre>"},{"location":"install-provision-samba4/#modificar-o-arquivo-etchostname","title":"Modificar o arquivo /etc/hostname","text":"<p>Configure um nome de hostname:</p> <pre><code>DC1\n</code></pre> <p>Fonte: Configura\u00e7\u00e3o do Samba como Controlador de Dom\u00ednio</p> <p>Reinicie o servidor.</p>"},{"location":"install-provision-samba4/#instalacao-do-pacote-samba4","title":"Instala\u00e7\u00e3o do pacote Samba4","text":"<pre><code>apt-get install gnupg\ngpg --keyserver hkp://keyring.debian.org --recv-key 701B4F6B1A693E59\ngpg --export --armor 804465C5 | gpg --dearmour -o /etc/apt/keyrings/804465C5.gpg\ngpg --delete-key 804465C5\necho \"deb [signed-by=/etc/apt/keyrings/804465C5.gpg] http://www.corpit.ru/mjt/packages/samba bookworm/samba-4.19/\" | tee -a /etc/apt/sources.list.d/mjt-samba4.list\napt-get update\napt-get install --no-install-recommends krb5-user krb5-config libldb2 libnss-winbind libpam-winbind libwbclient0 python3-ldb python3-samba samba samba-common samba-common-bin samba-dsdb-modules samba-libs samba-vfs-modules winbind\n</code></pre>"},{"location":"install-provision-samba4/#provisionamento","title":"Provisionamento","text":""},{"location":"install-provision-samba4/#parametros","title":"Par\u00e2metros","text":"<p>Para conhecer todos os par\u00e2metros, pode-se utilizar o comando:</p> <pre><code>samba-tool domain provision --help\n</code></pre>"},{"location":"install-provision-samba4/#comando-para-o-provisionamento","title":"Comando para o provisionamento","text":"<p>Para provisionar, execute o comando abaixo.</p> <pre><code>samba-tool domain provision --use-rfc2307 --interactive\n</code></pre> <p>Fonte: Configura\u00e7\u00e3o do Samba como Controlador de Dom\u00ednio</p>"},{"location":"install-provision-samba4/#restante-das-configuracoes","title":"Restante das Configura\u00e7\u00f5es","text":"<p>Acesse o link abaixo e siga o restante das configura\u00e7\u00f5es.</p> <p>Configurando o resolvedor DNS</p>"},{"location":"samba4_idmap_backend/","title":"Samba ID Mapping Backends","text":""},{"location":"samba4_idmap_backend/#tipos-de-backends-idmap","title":"Tipos de Backends IDMAP","text":"<p>Os backends de mapeamento de IDs no Samba (idmap) s\u00e3o utilizados para gerenciar a correspond\u00eancia entre os IDs de usu\u00e1rios e grupos no Windows e os IDs Unix (UIDs e GIDs). Tr\u00eas dos principais backends de idmap s\u00e3o <code>ad</code>, <code>rid</code> e <code>autorid</code>. Abaixo est\u00e1 um resumo de cada um deles com exemplos de configura\u00e7\u00e3o.</p>"},{"location":"samba4_idmap_backend/#idmap_ad","title":"idmap_ad","text":"<p>O backend <code>ad</code> utiliza os atributos RFC2307 do Active Directory para mapear usu\u00e1rios e grupos. Isso significa que os atributos <code>uidNumber</code> e <code>gidNumber</code> devem estar definidos no AD para que o mapeamento funcione corretamente. Este backend \u00e9 adequado quando se deseja que os IDs sejam consistentes e gerenci\u00e1veis diretamente no AD.</p> <p>Exemplo de configura\u00e7\u00e3o:</p> <pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = tdb\n   idmap config * : range = 1000000-1999999\n\n   idmap config SAMDOM : backend = ad\n   idmap config SAMDOM : range = 1000-999999\n   idmap config SAMDOM : schema_mode = rfc2307\n   idmap config SAMDOM : unix_nss_info = yes\n</code></pre> <p>Neste exemplo, os atributos Unix (como shell e diret\u00f3rio home) s\u00e3o lidos diretamente do AD se estiverem presentes\u301011\u2020source\u3011\u301013\u2020source\u3011.</p>"},{"location":"samba4_idmap_backend/#idmap_rid","title":"idmap_rid","text":"<p>O backend <code>rid</code> calcula os UIDs e GIDs usando o RID (Relative Identifier) dos objetos do AD. Ele \u00e9 simples de configurar e n\u00e3o requer que atributos espec\u00edficos sejam definidos no AD. Este backend garante que os mesmos RIDs resultar\u00e3o nos mesmos IDs Unix em diferentes membros do dom\u00ednio Samba.</p> <p>Exemplo de configura\u00e7\u00e3o:</p> <pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = tdb\n   idmap config * : range = 1000000-1999999\n\n   idmap config SAMDOM : backend = rid\n   idmap config SAMDOM : range = 1000-999999\n</code></pre> <p>Neste exemplo, o backend <code>rid</code> \u00e9 utilizado para o dom\u00ednio <code>SAMDOM</code>, e os IDs s\u00e3o gerados automaticamente com base nos RIDs do AD.</p>"},{"location":"samba4_idmap_backend/#idmap_autorid","title":"idmap_autorid","text":"<p>O backend <code>autorid</code> \u00e9 uma vers\u00e3o mais autom\u00e1tica do <code>rid</code>, ideal para ambientes com m\u00faltiplos dom\u00ednios. Ele atribui blocos de IDs a diferentes dom\u00ednios automaticamente, reduzindo a necessidade de administra\u00e7\u00e3o manual. No entanto, ele n\u00e3o garante que os IDs sejam os mesmos em diferentes membros do dom\u00ednio, a menos que a configura\u00e7\u00e3o seja cuidadosamente gerida.</p> <p>Exemplo de configura\u00e7\u00e3o:</p> <pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = autorid\n   idmap config * : range = 10000-24999999\n   idmap config * : rangesize = 200000\n</code></pre> <p>Neste exemplo, o <code>autorid</code> \u00e9 configurado para o dom\u00ednio padr\u00e3o, atribuindo IDs em blocos de 200.000 para cada dom\u00ednio conforme necess\u00e1rio.</p>"},{"location":"samba4_idmap_backend/#consideracoes-finais","title":"Considera\u00e7\u00f5es Finais","text":"<ul> <li>O backend <code>ad</code> \u00e9 indicado quando se precisa de um controle rigoroso dos atributos Unix diretamente no AD.</li> <li>O backend <code>rid</code> \u00e9 \u00fatil para uma configura\u00e7\u00e3o mais simples e direta, onde a consist\u00eancia de IDs entre diferentes servidores \u00e9 necess\u00e1ria.</li> <li>O backend <code>autorid</code> oferece uma configura\u00e7\u00e3o autom\u00e1tica e \u00e9 ideal para ambientes com m\u00faltiplos dom\u00ednios, embora precise de um cuidado especial para evitar sobreposi\u00e7\u00e3o de IDs.</li> </ul> <p>Cada backend tem seus benef\u00edcios e desvantagens, e a escolha depende das necessidades espec\u00edficas de gerenciamento de IDs e da infraestrutura de TI existente.</p>"},{"location":"samba4_idmap_backend/#melhor-escolha-de-backend-para-diferentes-ambientes","title":"Melhor escolha de backend para diferentes ambientes","text":""},{"location":"samba4_idmap_backend/#ambiente-com-1000-usuarios-2-ads-e-1-fileserver","title":"Ambiente com 1000 usu\u00e1rios, 2 ADs e 1 fileserver","text":"<p>Para um ambiente com 1000 usu\u00e1rios, utilizando 2 ADs e 1 fileserver, a melhor escolha de backend \u00e9 o <code>autorid</code>.</p> <p>Raz\u00f5es: 1. Escalabilidade: <code>autorid</code> gerencia m\u00faltiplos dom\u00ednios automaticamente, ideal para configura\u00e7\u00f5es com mais de um AD. 2. Simplicidade: Minimiza a administra\u00e7\u00e3o manual de ID ranges e evita sobreposi\u00e7\u00e3o de IDs, simplificando a configura\u00e7\u00e3o. 3. Consist\u00eancia: Garante a atribui\u00e7\u00e3o de IDs de forma autom\u00e1tica e consistente para usu\u00e1rios e grupos em diferentes dom\u00ednios e servidores.</p>"},{"location":"samba4_idmap_backend/#configuracao-exemplo","title":"Configura\u00e7\u00e3o Exemplo:","text":"<pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = autorid\n   idmap config * : range = 10000-24999999\n   idmap config * : rangesize = 200000\n</code></pre> <p>Essa configura\u00e7\u00e3o assegura que todos os usu\u00e1rios e grupos tenham IDs \u00fanicos e gerenci\u00e1veis automaticamente atrav\u00e9s dos dois ADs e o fileserver.</p>"},{"location":"samba4_idmap_backend/#ambiente-com-1000-usuarios-3-ads-e-2-fileservers","title":"Ambiente com 1000 usu\u00e1rios, 3 ADs e 2 fileservers","text":"<p>Para um ambiente com 1000 usu\u00e1rios, 3 ADs e 2 fileservers, a melhor escolha de backend \u00e9 o <code>ad</code>.</p> <p>Raz\u00f5es: 1. Consist\u00eancia de IDs: Garante que os IDs de usu\u00e1rios e grupos sejam consistentes em todos os servidores e dom\u00ednios. 2. Atributos Unix do AD: Permite a utiliza\u00e7\u00e3o de atributos Unix (UID, GID, shell, diret\u00f3rio home) diretamente do AD, facilitando a administra\u00e7\u00e3o centralizada. 3. Escalabilidade: Suporta um ambiente com m\u00faltiplos DCs e fileservers, mantendo a consist\u00eancia e a gest\u00e3o centralizada.</p>"},{"location":"samba4_idmap_backend/#configuracao-exemplo_1","title":"Configura\u00e7\u00e3o Exemplo:","text":"<pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = tdb\n   idmap config * : range = 1000000-1999999\n\n   idmap config SAMDOM : backend = ad\n   idmap config SAMDOM : range = 1000-999999\n   idmap config SAMDOM : schema_mode = rfc2307\n   idmap config SAMDOM : unix_nss_info = yes\n</code></pre> <p>Essa configura\u00e7\u00e3o permite que os atributos Unix sejam gerenciados diretamente no AD, garantindo consist\u00eancia e facilidade de administra\u00e7\u00e3o.</p>"},{"location":"samba4_idmap_backend/#ambiente-ideal-para-utilizar-o-backend-ad","title":"Ambiente ideal para utilizar o backend <code>ad</code>","text":"<p>Voc\u00ea deve utilizar o backend <code>ad</code> em um ambiente onde:</p> <ul> <li>N\u00famero m\u00ednimo de usu\u00e1rios: 500 ou mais.</li> <li>N\u00famero m\u00ednimo de DCs: 2 (para alta disponibilidade e redund\u00e2ncia).</li> <li>N\u00famero m\u00ednimo de fileservers: 2 (para garantir a consist\u00eancia dos atributos Unix).</li> </ul>"},{"location":"samba4_idmap_backend/#razoes-para-usar-ad","title":"Raz\u00f5es para usar <code>ad</code>:","text":"<ol> <li>Consist\u00eancia de IDs: Garante que os IDs de usu\u00e1rios e grupos sejam consistentes em todos os servidores.</li> <li>Atributos Unix: Permite a utiliza\u00e7\u00e3o de atributos Unix (UID, GID, shell, diret\u00f3rio home) diretamente do AD, facilitando a administra\u00e7\u00e3o centralizada.</li> <li>Complexidade do ambiente: Adequado para ambientes onde \u00e9 necess\u00e1rio um controle preciso sobre os IDs e atributos Unix, especialmente com m\u00faltiplos DCs e fileservers.</li> </ol>"},{"location":"samba4_idmap_backend/#configuracao-exemplo_2","title":"Configura\u00e7\u00e3o Exemplo:","text":"<pre><code>[global]\n   security = ADS\n   workgroup = SAMDOM\n   realm = SAMDOM.EXAMPLE.COM\n\n   idmap config * : backend = tdb\n   idmap config * : range = 1000000-1999999\n\n   idmap config SAMDOM : backend = ad\n   idmap config SAMDOM : range = 1000-999999\n   idmap config SAMDOM : schema_mode = rfc2307\n   idmap config SAMDOM : unix_nss_info = yes\n</code></pre> <p>Essa configura\u00e7\u00e3o permite que os atributos Unix sejam gerenciados diretamente no AD, garantindo consist\u00eancia e facilidade de administra\u00e7\u00e3o.</p>"},{"location":"under_construiction/","title":"UNDER CONSTRUCTION","text":""}]}